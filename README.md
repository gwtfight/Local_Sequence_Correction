# Local_Sequence_Correction
This toolkit implements two main functionalities:

K-mer spectrum-based haplotype matching method (HapMatch)
Sliding window-based local sequence correction method (HapCorrect)
These methods work together to identify the correspondence between haplotypes generated by different assembly methods (such as GenoPhase and Hifiasm-HiC) and improve assembly accuracy while maintaining contiguity.

Table of Contents
Requirements
Installation
Usage
Parameters
Output
Methods
Examples
FAQ
Citation
License
Requirements
Hardware Requirements
Minimum 8GB RAM (more may be needed for large genomes)
Multi-core processor (for parallel computation)
Sufficient disk space for input and output files
Software Dependencies
Python 3.7+
Jellyfish 2.3+ (for k-mer counting)
Minimap2 (for sequence alignment)
Python Dependencies
NumPy
Pandas
Matplotlib
Seaborn
Biopython
UMAP-learn
SciPy



Parameters
Required Parameters
--genophase_hapa: Path to GenoPhase hapA haplotype FASTA file
--genophase_hapb: Path to GenoPhase hapB haplotype FASTA file
--hifiasm_hap1: Path to Hifiasm-HiC hap1 haplotype FASTA file
--hifiasm_hap2: Path to Hifiasm-HiC hap2 haplotype FASTA file
Optional Parameters
--k_values: Comma-separated list of k-mer sizes (default: 21,31,41)
--window_base: Base window size for correction (default: 10000, i.e., 10kb)
--output_dir: Output directory (default: output)
--threads: Number of threads to use (default: 1)
Output
The program creates the following files and directories in the specified output directory:

K-mer Analysis Output (kmer_analysis/)
kmer_counts/: K-mer count results for each haplotype
plots/: Visualizations of k-mer spectrum analysis
umap_projection_k*.png: UMAP dimensionality reduction projections of k-mer spectra
similarity_matrix_k*.png: Similarity matrix heatmaps for each k value
integrated_similarity_matrix.png: Integrated similarity matrix heatmap
integrated_similarity_matrix.csv: Integrated similarity matrix data
haplotype_matches.txt: Haplotype matching results
Sequence Correction Output (correction/)
temp/: Temporary files used during correction
alignments/: Sequence alignment results
corrections/: Corrected sequences from each iteration
reports/: Correction reports
*_correction_report.txt: Text-format correction report
*_correction_progress.png: Visualization of correction progress and effectiveness
*_final_corrected.fasta: Final corrected FASTA sequences
Methods
Haplotype Matching Method
This method uses k-mer spectrum similarity analysis to identify the correspondence between haplotypes generated by different assembly methods. The key steps include:

K-mer Spectrum Construction:
Using Jellyfish to calculate k-mer frequency distributions for multiple k values.
Normalization and Dimensionality Reduction:
Normalizing k-mer spectrum vectors and using UMAP to project high-dimensional data to a two-dimensional space.
Similarity Calculation:
Computing cosine similarity between different haplotypes in the reduced dimension space.
Multi-k Integration:
Integrating analysis results from different k values to obtain final similarity scores.
Sliding Window-based Local Sequence Correction
This method uses sliding windows to perform local sequence correction, improving assembly accuracy while maintaining sequence contiguity. The key steps include:

Adaptive Window Design:
Dynamically adjusting window size based on region characteristics.
Error Detection and Probability Calculation:
Computing error probability for sequences within each window.
Dynamic Error Threshold Model:
Setting dynamic thresholds based on region complexity.
Conditional Correction Mechanism:
Executing appropriate correction strategies based on different error types.
Correction Cycle Termination Mechanism:
Deciding whether to continue iteration by evaluating correction effectiveness.
